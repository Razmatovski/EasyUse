<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Łazienka pod klucz</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
    #hero { text-align: center; margin-top: 40px; }
    .step { display: none; }
    #nav { margin-top: 20px; }
    button { padding: 8px 16px; margin: 4px; }
  </style>
</head>
<body>
  <div id="lang-selector">
    <select id="lang">
      <option value="pl">PL</option>
      <option value="en">EN</option>
      <option value="ua">UA</option>
    </select>
  </div>
  <section id="hero">
    <h1 data-i18n="heroTitle">Łazienka pod klucz</h1>
    <p data-i18n="heroSubtitle">Szybka wycena online</p>
    <button id="startBtn" data-i18n="start">Rozpocznij</button>
  </section>

  <form id="quiz" style="display:none;">
    <div class="step" data-step="0">
      <label for="postal_code" data-i18n="postalCode">Kod pocztowy</label>
      <input id="postal_code" />
    </div>
    <div class="step" data-step="1">
      <p data-i18n="areaQuestion">Powierzchnia łazienki?</p>
      <label><input type="radio" name="area" value="2-4"/>2-4 m²</label><br/>
      <label><input type="radio" name="area" value="4-6"/>4-6 m²</label><br/>
      <label><input type="radio" name="area" value="6-8"/>6-8 m²</label><br/>
      <label><input type="radio" name="area" value="8+"/>8+ m²</label>
    </div>
    <div class="step" data-step="2">
      <p data-i18n="scopeQuestion">Zakres prac?</p>
      <label><input type="radio" name="scope" value="tiling_only"/>Tylko płytki</label><br/>
      <label><input type="radio" name="scope" value="full_renovation_no_furniture"/>Generalny remont</label><br/>
      <label><input type="radio" name="scope" value="turnkey_with_fixtures_furniture"/>Pod klucz</label>
    </div>
    <div class="step" data-step="3">
      <p data-i18n="tileQuestion">Typ płytek?</p>
      <label><input type="radio" name="tile" value="<=60x60"/><=60x60</label><br/>
      <label><input type="radio" name="tile" value=">=60x120"/>>=60x120</label><br/>
      <label><input type="radio" name="tile" value="mosaic"/>Mozaika</label>
    </div>
    <div class="step" data-step="4">
      <p data-i18n="plumbingQuestion">Dodatki hydrauliczne?</p>
      <label><input type="checkbox" id="wall_hung_wc"/>WC podwieszane</label><br/>
      <label><input type="checkbox" id="shower_or_bath"/>Prysznic lub wanna</label><br/>
      <label><input type="checkbox" id="vanity_sink"/>Szafka z umywalką</label><br/>
      <label><input type="checkbox" id="rain_shower"/>Deszczownica</label><br/>
      <label><input type="checkbox" id="floor_heating"/>Ogrzewanie podłogowe</label>
    </div>
    <div class="step" data-step="5">
      <label data-i18n="name">Imię</label>
      <input id="name"/><br/>
      <label data-i18n="phone">Telefon</label>
      <input id="phone"/>
    </div>
    <div class="step" data-step="6">
      <p data-i18n="resultText">Szacunkowa wycena:</p>
      <p id="result"></p>
      <a id="waLink" target="_blank" data-i18n="whatsapp">WhatsApp</a>
      <a id="callLink" data-i18n="call">Zadzwoń</a>
    </div>
    <div id="nav">
      <button type="button" id="prevBtn" data-i18n="prev">Wstecz</button>
      <button type="button" id="nextBtn" data-i18n="next">Dalej</button>
    </div>
  </form>

<script>
const translations = {
  pl: {
    heroTitle: 'Łazienka pod klucz',
    heroSubtitle: 'Szybka wycena online',
    start: 'Rozpocznij',
    postalCode: 'Kod pocztowy',
    areaQuestion: 'Powierzchnia łazienki?',
    scopeQuestion: 'Zakres prac?',
    tileQuestion: 'Typ płytek?',
    plumbingQuestion: 'Dodatki hydrauliczne?',
    name: 'Imię',
    phone: 'Telefon',
    resultText: 'Szacunkowa wycena:',
    whatsapp: 'WhatsApp',
    call: 'Zadzwoń',
    prev: 'Wstecz',
    next: 'Dalej'
  },
  en: {
    heroTitle: 'Turnkey bathroom',
    heroSubtitle: 'Quick online quote',
    start: 'Start',
    postalCode: 'Postal code',
    areaQuestion: 'Bathroom area?',
    scopeQuestion: 'Scope of work?',
    tileQuestion: 'Tile type?',
    plumbingQuestion: 'Plumbing extras?',
    name: 'Name',
    phone: 'Phone',
    resultText: 'Estimated quote:',
    whatsapp: 'WhatsApp',
    call: 'Call',
    prev: 'Back',
    next: 'Next'
  },
  ua: {
    heroTitle: 'Ванна кімната під ключ',
    heroSubtitle: 'Швидкий розрахунок онлайн',
    start: 'Почати',
    postalCode: 'Поштовий індекс',
    areaQuestion: 'Площа ванної?',
    scopeQuestion: 'Обсяг робіт?',
    tileQuestion: 'Тип плитки?',
    plumbingQuestion: 'Додаткова сантехніка?',
    name: 'Імʼя',
    phone: 'Телефон',
    resultText: 'Приблизна оцінка:',
    whatsapp: 'WhatsApp',
    call: 'Дзвінок',
    prev: 'Назад',
    next: 'Далі'
  }
};
function setLanguage(lang){
  const dict = translations[lang];
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    if(dict[key]) el.textContent = dict[key];
  });
  state.lang = lang;
}
const langSel = document.getElementById('lang');
langSel.value = (navigator.language || 'pl').substring(0,2);
if(!translations[langSel.value]) langSel.value = 'pl';
setLanguage(langSel.value);
langSel.addEventListener('change', e => setLanguage(e.target.value));

const startBtn = document.getElementById('startBtn');
const hero = document.getElementById('hero');
const form = document.getElementById('quiz');
const steps = Array.from(document.querySelectorAll('.step'));
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
let currentStep = 0;
const state = { plumbing:{} };
function showStep(i){
  steps.forEach((s, idx)=> s.style.display = idx===i ? 'block':'none');
  if(i===0) prevBtn.style.display='none'; else prevBtn.style.display='inline-block';
  if(i===steps.length-1){ nextBtn.style.display='none'; } else nextBtn.style.display='inline-block';
}
startBtn.onclick = () => { hero.style.display='none'; form.style.display='block'; showStep(0); };
prevBtn.onclick = () => { if(currentStep>0){ currentStep--; showStep(currentStep);} };
nextBtn.onclick = async () => {
  if(currentStep===0){ state.postal_code = document.getElementById('postal_code').value; }
  if(currentStep===1){ const a=document.querySelector('input[name="area"]:checked'); if(a) state.area_m2=a.value; }
  if(currentStep===2){ const s=document.querySelector('input[name="scope"]:checked'); if(s) state.scope=s.value; }
  if(currentStep===3){ const t=document.querySelector('input[name="tile"]:checked'); if(t) state.tile_type=t.value; }
  if(currentStep===4){ state.plumbing={
    wall_hung_wc: document.getElementById('wall_hung_wc').checked,
    shower_or_bath: document.getElementById('shower_or_bath').checked,
    vanity_sink: document.getElementById('vanity_sink').checked,
    rain_shower: document.getElementById('rain_shower').checked,
    floor_heating: document.getElementById('floor_heating').checked
  }; }
  if(currentStep===5){
    state.name = document.getElementById('name').value;
    state.phone = document.getElementById('phone').value;
    const res = await fetch('/api/estimate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({area_m2:state.area_m2,scope:state.scope,tile_type:state.tile_type,plumbing:state.plumbing,postal_code:state.postal_code})});
    const data = await res.json();
    state.estimate = { low:data.low, high:data.high, days_min:data.days_min, days_max:data.days_max };
    state.serviceable = data.serviceable;
    state.distance_km = data.distance_km;
    document.getElementById('result').textContent = `${data.low}-${data.high} PLN, ${data.days_min}-${data.days_max} dni`;
    fetch('/api/leads',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(state)});
    const wa = buildWhatsAppLink({phone:'48500111222',lang:state.lang,payload:{name:state.name,phone:state.phone,estimate:data}});
    document.getElementById('waLink').href = wa;
    document.getElementById('callLink').href = 'tel:48500111222';
  }
  if(currentStep < steps.length-1){ currentStep++; showStep(currentStep); }
};
function buildWhatsAppLink(opts){
  const t={
    pl:(p)=>`Dzień dobry! Interesuje mnie łazienka pod klucz. Szacunek: ${p.estimate.low}-${p.estimate.high} PLN, termin: ${p.estimate.days_min}-${p.estimate.days_max} dni. Proszę o kontakt.`,
    en:(p)=>`Hello! I'm interested in a turnkey bathroom. Estimate: ${p.estimate.low}-${p.estimate.high} PLN, timeline: ${p.estimate.days_min}-${p.estimate.days_max} days. Please contact me.`,
    ua:(p)=>`Вітаю! Цікавить санвузол під ключ. Оцінка: ${p.estimate.low}-${p.estimate.high} PLN, термін: ${p.estimate.days_min}-${p.estimate.days_max} днів. Прошу зв’язок.`
  }[opts.lang](opts.payload);
  return `https://wa.me/${opts.phone}?text=${encodeURIComponent(t)}`;
}
</script>
</body>
</html>
